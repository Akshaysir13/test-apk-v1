-- Create user_sessions table
CREATE TABLE user_sessions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_email TEXT NOT NULL,
  device_id TEXT NOT NULL,
  session_token TEXT NOT NULL UNIQUE,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create indexes for fast queries
CREATE INDEX idx_sessions_token ON user_sessions(session_token);
CREATE INDEX idx_sessions_email ON user_sessions(user_email);
CREATE INDEX idx_sessions_device ON user_sessions(device_id);

-- Enable Row Level Security
ALTER TABLE user_sessions ENABLE ROW LEVEL SECURITY;

-- Policies
CREATE POLICY "Anyone can view sessions"
  ON user_sessions FOR SELECT
  USING (true);

CREATE POLICY "Anyone can insert sessions"
  ON user_sessions FOR INSERT
  WITH CHECK (true);

CREATE POLICY "Anyone can delete sessions"
  ON user_sessions FOR DELETE
  USING (true);

CREATE POLICY "Anyone can update sessions"
  ON user_sessions FOR UPDATE
  USING (true);